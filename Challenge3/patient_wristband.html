<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SaintCon Hospital - Patient Wristband</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrious/4.0.2/qrious.min.js"></script>
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: 'Courier New', monospace;
            background-color: #f0f0f0;
        }
        
        .wristband {
            width: 8.5in;
            height: 1in;
            background: linear-gradient(135deg, #ffffff 0%, #f8f8f8 100%);
            border: 2px solid #0066cc;
            border-radius: 10px;
            display: flex;
            align-items: center;
            padding: 10px;
            margin: 20px auto;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            position: relative;
            overflow: hidden;
        }
        
        .hospital-logo {
            width: 60px;
            height: 60px;
            background: #0066cc;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 16px;
            margin-right: 15px;
            flex-shrink: 0;
        }
        
        .patient-info {
            flex-grow: 1;
            line-height: 1.2;
        }
        
        .hospital-name {
            font-size: 14px;
            font-weight: bold;
            color: #0066cc;
            margin-bottom: 2px;
        }
        
        .patient-name {
            font-size: 18px;
            font-weight: bold;
            color: #333;
            margin-bottom: 2px;
        }
        
        .patient-details {
            font-size: 11px;
            color: #666;
            display: flex;
            gap: 15px;
        }
        
        .qr-container {
            margin-left: 15px;
            text-align: center;
            flex-shrink: 0;
        }
        
        #qrcode {
            margin-bottom: 5px;
        }
        
        .qr-label {
            font-size: 8px;
            color: #666;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .watermark {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) rotate(-45deg);
            font-size: 48px;
            color: rgba(255, 0, 0, 0.1);
            font-weight: bold;
            pointer-events: none;
            z-index: 1;
        }
        
        .print-instructions {
            max-width: 8.5in;
            margin: 20px auto;
            padding: 20px;
            background: #fff;
            border-radius: 10px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .vulnerable-data {
            margin-top: 20px;
            padding: 15px;
            background: #f8f8f8;
            border-left: 4px solid #ff6b35;
            font-family: monospace;
            font-size: 12px;
        }
        
        .challenge-hint {
            margin-top: 20px;
            padding: 15px;
            background: #e8f4f8;
            border-left: 4px solid #0066cc;
            border-radius: 4px;
        }
        
        @media print {
            body { background: white; }
            .print-instructions, .vulnerable-data, .challenge-hint { display: none; }
            .wristband { 
                margin: 0;
                box-shadow: none;
                page-break-inside: avoid;
            }
        }
    </style>
</head>
<body>
    <div class="wristband">
        <div class="watermark">DISCARDED</div>
        <div class="hospital-logo">MG</div>
        <div class="patient-info">
            <div class="hospital-name">SAINTCON HOSPITAL</div>
            <div class="patient-name">ELIZABETH HARTWELL</div>
            <div class="patient-details">
                <span>DOB: 03/15/1962</span>
                <span>MRN: VIP-7741</span>
                <span>Room: 311</span>
                <span>Adm: 10/21/2025</span>
            </div>
        </div>
        <div class="qr-container">
            <canvas id="qrcode" width="100" height="100"></canvas>
            <div class="qr-label">Patient ID</div>
        </div>
    </div>
    
    <div class="print-instructions">
        <h2>üè• CTF Challenge 3: The Patient Wristband</h2>
        <p><strong>Story Context:</strong> Following the IVR clues from Challenge 2, you've arrived at Room 311 where you discover this discarded patient wristband on the floor near the room entrance.</p>
        
        <p><strong>Instructions:</strong></p>
        <ol>
            <li>Print this wristband on regular paper (will print at actual size)</li>
            <li>Participants should scan the QR code and analyze the data</li>
            <li>Look for suspicious or vulnerable encoding methods</li>
            <li>The patient ID reveals important information about the targeted VIP</li>
        </ol>
        
        <div class="challenge-hint">
            <h3>üéØ CTF Design Notes:</h3>
            <p><strong>Vulnerability:</strong> The QR code contains base64-encoded data that reveals sensitive patient information when decoded. This demonstrates how medical wristbands can leak more data than intended.</p>
            <p><strong>Skills Tested:</strong> QR code scanning, base64 decoding, data analysis</p>
            <p><strong>Progression:</strong> The decoded patient ID (VIP-7741) connects to Challenge 4, where this VIP patient's medical devices will be mentioned in the PA announcement.</p>
        </div>
    </div>
    
    <div class="vulnerable-data">
        <h3>üîç What the QR Code Contains:</h3>
        <p><strong>Raw QR Data:</strong> <span id="qr-raw-data"></span></p>
        <p><strong>Decoded Data (Base64):</strong></p>
        <pre id="decoded-data"></pre>
        <p><strong>Flag:</strong> <code>Flag{VIP_PATIENT_7741_TARGETED}</code></p>
    </div>

    <script>
        // Create QR data that will display as text, not be interpreted as URL
        const flagData = "flag{VIP_PATIENT_7741_TARGETED}";
        const patientData = "patientId:{VIP-7741},name:{ELIZABETH HARTWELL},ssn:{***-**-4892},room:{311},condition:{CARDIAC_MONITORING},physician:{DR_REYNOLDS},insurance:{PREMIUM_EXECUTIVE},emergency_contact:{SENATOR_HARTWELL},medical_devices:{CARDIAC_MONITOR_CM400,IV_PUMP_IP200}";
        
        // Use a format that won't trigger URL interpretation
        const qrContent = `PATIENT_DATA:${btoa(patientData + "|" + flagData)}`;
        
        console.log('QR Content:', qrContent);
        console.log('To decode manually:', btoa(patientData + "|" + flagData));
        
        // Display the data for organizers
        document.getElementById('qr-raw-data').textContent = qrContent;
        document.getElementById('decoded-data').textContent = `Raw: ${patientData}\nFlag: ${flagData}\n\nBase64 decode: ${btoa(patientData + "|" + flagData)}`;
        
        // Generate QR code
        const canvas = document.getElementById('qrcode');
        
        try {
            const qr = new QRious({
                element: canvas,
                value: qrContent,
                size: 100,
                background: '#ffffff',
                foreground: '#000000',
                level: 'L'
            });
            console.log('QR generated with content:', qrContent);
        } catch (error) {
            console.error('QR generation failed:', error);
        }
    </script>
</body>
</html>